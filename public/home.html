<html>
    <head>
        <style>
            #mapid{
    height:100%;
    width: 100%;
}
        </style>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
   integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
   crossorigin=""/>
   <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
   integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
   crossorigin=""></script>
   <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    </head>

<div id="mapid" style=></div>
            <script>
            var map = L.map('mapid', {
                maxZoom: 50,
                minZoom: 8,
            
            }).setView([27.1760576, 77.758213],4);
           var func= ()=>{
            axios.get('http://localhost:3000/api')
                .then(response => {
                    response.data.forEach((x)=>{
                        var block=x._id;
                        var inuse=x.inuse;
                        var total=x.total;
                        console.log(block, inuse, total);
                    axios.get(`https://nominatim.openstreetmap.org/?format=json&country=india&state=andhra+pradesh&city=${block}&format=json&limit=1`,{
                        inuse,
                        total
                    })
                .then((response) => {
                    if(response.data.length!==0)
                    {
                    //console.log(total);
                    //console.log(inuse);
                    //console.log(response.data[0]);
                    var lat=response.data[0].lat;
                    var long=response.data[0].lon;
                    var marker = L.marker([lat, long],{fillColor:'red'}).addTo(map);
                    marker.bindPopup("<b>SHALLOW TUBEWELLS</b><br><b>total "+total+"</b><br>"+"<b>inuse "+inuse+"</b><br>").openPopup();
                    }

                })
                .catch(error => {
                    console.log(error);
                });

                    })
                 
            })
            .catch(error=>{
                console.log(error);
            })
            axios.get('http://localhost:3000/api/deep')
                .then(response => {
                    response.data.forEach((x)=>{
                        var block=x._id;
                        var inuse=x.inuse;
                        var total=x.total;
                        console.log(block, inuse, total);
                    axios.get(`https://nominatim.openstreetmap.org/?format=json&country=india&state=andhra+pradesh&city=${block}&format=json&limit=1`,{
                        inuse,
                        total
                    })
                .then((response) => {
                    if(response.data.length!==0)
                    {
                    //console.log(total);
                    //console.log(inuse);
                    //console.log(response.data[0]);
                    var lat=response.data[0].lat;
                    var long=response.data[0].lon;
                    var circle = L.circle([lat,long], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.5,
                    radius: 20000
                    }).addTo(map);
                    circle.bindPopup("<b>DEEP TUBEWELLS</b><br><b>total "+total+"</b><br>"+"<b>inuse "+inuse+"</b><br>").openPopup();
                    }

                })
                .catch(error => {
                    console.log(error);
                });

                    })
                 
            })
            .catch(error=>{
                console.log(error);
            })
        }
        var func1= ()=>{
            axios.get('http://localhost:3000/api/district')
                .then(response => {
                    response.data.forEach((x)=>{
                        var block=x.BLOCK;
                        var inuse=x.INUSE;
                        var total=x.TOTAL;
                        console.log(block, inuse, total);
                    axios.get(`https://nominatim.openstreetmap.org/?format=json&country=india&state=uttar+pradesh&city=${block}&format=json&limit=1`,{
                        inuse,
                        total
                    })
                .then((response) => {
                    if(response.data.length!==0)
                    {
                    console.log(total);
                    console.log(inuse);
                    console.log(response.data[0]);
                    var lat=response.data[0].lat;
                    var long=response.data[0].lon;
                    var marker = L.marker([lat, long]).addTo(map);
                    marker.bindPopup("<b>SHALLOW TUBEWELLS</b><br><b>total "+total+"</b><br>"+"<b>inuse "+inuse+"</b><br>").openPopup();
                    }

                })
                .catch(error => {
                    console.log(error);
                });

                    })
                 
            })
            .catch(error=>{
                console.log(error);
            })
            axios.get('http://localhost:3000/api/district/deep')
                .then(response => {
                    response.data.forEach((x)=>{
                        var block=x.BLOCK;
                        var inuse=x.INUSE;
                        var total=x.TOTAL;
                        console.log(block, inuse, total);
                    axios.get(`https://nominatim.openstreetmap.org/?format=json&country=india&state=uttar+pradesh&city=${block}&format=json&limit=1`,{
                        inuse,
                        total
                    })
                .then((response) => {
                    if(response.data.length!==0)
                    {
                    console.log(total);
                    console.log(inuse);
                    console.log(response.data[0]);
                    var lat=response.data[0].lat;
                    var long=response.data[0].lon;
                    var circle = L.circle([lat,long], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.5,
                    radius: 20000
                    }).addTo(map);
                    circle.bindPopup("<b>DEEP TUBEWELLS</b><br><b>total "+total+"</b><br>"+"<b>inuse "+inuse+"</b><br>").openPopup();
                    }


                })
                .catch(error => {
                    console.log(error);
                });

                    })
                 
            })
            .catch(error=>{
                console.log(error);
            })
        }
        var func2= ()=>{
            axios.get('http://localhost:3000/api/block')
                .then(response => {
                    response.data.forEach((x)=>{
                        var block=x.BLOCK;
                        var inuse=x.INUSE;
                        var total=x.TOTAL;
                        console.log(block, inuse, total);
                    axios.get(`https://nominatim.openstreetmap.org/?format=json&country=india&state=uttar+pradesh&city=${block}&format=json&limit=1`,{
                        inuse,
                        total
                    })
                .then((response) => {
                    if(response.data.length!==0)
                    {
                    console.log(total);
                    console.log(inuse);
                    console.log(response.data[0]);
                    var lat=response.data[0].lat;
                    var long=response.data[0].lon;
                    var marker = L.marker([lat, long]).addTo(map);
                    marker.bindPopup("<b>SHALLOW TUBEWELLS</b></br><b>total "+total+"</b><br>"+"<b>inuse "+inuse+"</b><br>").openPopup();
                    }

                })
                .catch(error => {
                    console.log(error);
                });

                    })
                 
            })
            .catch(error=>{
                console.log(error);
            })
            axios.get('http://localhost:3000/api/block/deep')
                .then(response => {
                    response.data.forEach((x)=>{
                        var block=x.BLOCK;
                        var inuse=x.INUSE;
                        var total=x.TOTAL;
                        console.log(block, inuse, total);
                    axios.get(`https://nominatim.openstreetmap.org/?format=json&country=india&state=uttar+pradesh&city=${block}&format=json&limit=1`,{
                        inuse,
                        total
                    })
                .then((response) => {
                    if(response.data.length!==0)
                    {
                    console.log(total);
                    console.log(inuse);
                    console.log(response.data[0]);
                    var lat=response.data[0].lat;
                    var long=response.data[0].lon;
                    var circle = L.circle([lat,long], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.5,
                    radius: 20000
                    }).addTo(map);
                    circle.bindPopup("<b>DEEP TUBEWELLS</b><br><b>total "+total+"</b><br>"+"<b>inuse "+inuse+"</b><br>").openPopup();
                    }

                })
                .catch(error => {
                    console.log(error);
                });

                    })
                 
            })
            .catch(error=>{
                console.log(error);
            })
        }
         var func3=()=>{
            axios.get('http://localhost:3000/api/filter2')
            .then(response => {
                response.data.forEach((x)=>{
                        var block=x.BLOCK;
                        var census1=x.CENSUS1;
                        var census2=x.CENSUS2;
                        //console.log(block, inuse, total);
                    axios.get(`https://nominatim.openstreetmap.org/?format=json&country=india&state=uttar+pradesh&city=${block}&format=json&limit=1`,{
                        census1,
                        census2,
                        block
                    })
                .then((response) => {
                    if(response.data.length!==0)
                    {
                    var lat=response.data[0].lat;
                    var long=response.data[0].lon;
                    var marker = L.marker([lat, long]).addTo(map);
                    var k = ((Math.abs(census2-census1))/census1)*100;
                    k=k.toPrecision(4);
                    marker.bindPopup("<b>BLOCK:</b>"+block+"</br><b>PERCENT INCREASE:</b></br><b><b>"+k+"</b></b><br>").openPopup();
                    }
                })
                .catch(error => {
                    console.log(error);
                });

                    })
                    })
            .catch(error=>{
                console.log(error);
            })

         }
           func3();
            // map.on('click', onMapClick);
                   
                    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                        maxZoom: 18,
                        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                            '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                           'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                        id: 'mapbox.streets'
                    }).addTo(map);
	
              //  func1();
                </script>
    </body>
    </head>
</html>